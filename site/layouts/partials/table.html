<!-- Search and export controls -->
<div class="result-info">
    <div style="display: flex; gap: 15px; align-items: center;">
        <input type="text" id="searchInput" placeholder="Search apps..."
            style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; width: 250px; font-size: 0.9em;" />
        <div>Showing <strong id="resultCount">0</strong> apps</div>
    </div>
    <div style="display: flex; gap: 10px;">
        <button id="exportCSV" class="export-btn">Export to CSV</button>
        <button id="clearFilters" class="clear-filters-btn">Clear All Filters</button>
    </div>
</div>

<table id="appsTable">
    <thead>
        <!-- Row 1: Column names with tooltips -->
        <tr>
            <th data-tooltip="Application name"><span class="header-text">App</span><span class="sort-arrows">⇅</span>
            </th>
            <th data-tooltip="App category (Collaboration, Productivity, Development, Sales)"><span
                    class="header-text">Category</span><span class="sort-arrows">⇅</span></th>
            <th data-tooltip="Does this app support SSO? Shows checkmark and minimum tier needed"><span
                    class="header-text">SSO</span><span class="sort-arrows">⇅</span></th>
            <th data-tooltip="Which SSO protocols does this app support?"><span class="header-text">SSO
                    Protocols</span><span class="sort-arrows">⇅</span></th>
            <th data-tooltip="Does this app support automated user provisioning via SCIM?"><span
                    class="header-text">SCIM</span><span class="sort-arrows">⇅</span></th>
            <th data-tooltip="Does this app support MFA? Shows how it can be enforced"><span
                    class="header-text">MFA</span><span class="sort-arrows">⇅</span></th>
            <th data-tooltip="Which MFA methods does this app support?"><span class="header-text">MFA Types</span><span
                    class="sort-arrows">⇅</span></th>
            <th data-tooltip="Which security certifications does this app have?"><span
                    class="header-text">Compliance</span><span class="sort-arrows">⇅</span></th>
            <th data-tooltip="When we last verified this information"><span class="header-text">Last
                    Verified</span><span class="sort-arrows">⇅</span></th>
        </tr>

        <!-- Row 2: Filter dropdowns -->
        <tr class="filter-row">
            <th><select id="filterApp">
                    <option value="">All</option>
                </select></th>
            <th>
                <div class="multi-select" id="filterCategory">
                    <div class="multi-select-display empty"></div>
                    <div class="multi-select-dropdown"></div>
                </div>
            </th>
            <th><select id="filterSSO">
                    <option value="">All</option>
                </select></th>
            <th>
                <div class="multi-select" id="filterSSOProtocols">
                    <div class="multi-select-display empty"></div>
                    <div class="multi-select-dropdown"></div>
                </div>
            </th>
            <th><select class="multi-select" id="filterSCIM">
                    <option value="">All</option>
                </select></th>
            <th><select id="filterMFA">
                    <option value="">All</option>
                </select></th>
            <th>
                <div class="multi-select" id="filterMFATypes">
                    <div class="multi-select-display empty"></div>
                    <div class="multi-select-dropdown"></div>
                </div>
            </th>
            <th>
                <div class="multi-select" id="filterCompliance">
                    <div class="multi-select-display empty"></div>
                    <div class="multi-select-dropdown"></div>
                </div>
            </th>
            <th><select id="filterVerified">
                    <option value="">All</option>
                </select></th>
        </tr>
    </thead>
    <tbody>
        {{ range $.Site.Data.apps }}
        <tr>
            <!-- App Name -->
            <td data-app="{{ .name }}"><a href="{{ .website }}" target="_blank" rel="noopener">{{ .name }}</a></td>

            <!-- Category -->
            <td data-category="{{ .category }}" style="text-transform: capitalize;">{{ .category }}</td>

            <!-- SSO -->
            <td data-sso="{{ if .sso.supported }}{{ .sso.tier }}{{ else }}none{{ end }}">
                {{ if .sso.supported }}
                <span class="check">✓</span>
                <span class="tier">{{ .sso.tier }}</span>
                {{ else }}
                <span class="cross">✗</span>
                {{ end }}
            </td>

            <!-- SSO Protocols -->
            <td data-sso-protocols="{{ delimit .sso.protocols " ," }}">
                {{ if .sso.supported }}
                {{ delimit .sso.protocols ", " }}
                {{ else }}
                <span class="cross">—</span>
                {{ end }}
            </td>

            <!-- SCIM -->
            <td data-scim="{{ .scim.tier }}">
                {{ if eq .scim.supported "full" }}
                <span class="check">✓</span>
                <span class="tier">{{ .scim.tier }}</span>
                {{ else if eq .scim.supported "partial" }}
                <span class="partial">~</span>
                <span class="tier">{{ .scim.tier }}</span>
                {{ else if eq .scim.supported true }}
                <span class="check">✓</span>
                <span class="tier">{{ .scim.tier }}</span>
                {{ else }}
                <span class="cross">✗</span>
                {{ end }}
            </td>

            <!-- MFA -->
            <td data-mfa="{{ if .mfa.supported }}{{ .mfa.enforcement }}{{ else }}none{{ end }}">
                {{ if .mfa.supported }}
                <span class="check">✓</span>
                {{ if eq .mfa.enforcement "admin_enforced" }}
                Admin enforced
                {{ else if eq .mfa.enforcement "optional" }}
                Optional
                {{ else if eq .mfa.enforcement "required" }}
                Required
                {{ else }}
                {{ .mfa.enforcement }}
                {{ end }}
                {{ else }}
                <span class="cross">✗</span>
                {{ end }}
            </td>

            <!-- MFA Types -->
            <td data-mfa-types="{{ delimit .mfa.types " ," }}">
                {{ if .mfa.supported }}
                {{ delimit .mfa.types ", " }}
                {{ else }}
                <span class="cross">—</span>
                {{ end }}
            </td>

            <!-- Compliance -->
            <td
                data-compliance="{{ if .compliance.soc2 }}soc2{{ end }}{{ if and .compliance.soc2 .compliance.iso27001 }},{{ end }}{{ if .compliance.iso27001 }}iso27001{{ end }}">
                {{ if .compliance.soc2 }}SOC2{{ end }}{{ if and .compliance.soc2 .compliance.iso27001 }}, {{ end }}{{ if
                .compliance.iso27001 }}ISO27001{{ end }}
                {{ if and (not .compliance.soc2) (not .compliance.iso27001) }}<span class="cross">—</span>{{ end }}
            </td>

            <!-- Last Verified -->
            <td data-verified="{{ .meta.last_verified }}">{{ .meta.last_verified }}</td>
        </tr>
        {{ end }}
    </tbody>
</table>