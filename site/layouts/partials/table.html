<script src="https://cdn.tailwindcss.com"></script>

<style type="text/tailwindcss">
    @layer utilities {
        /* JS Tooltip */
        .custom-tooltip { @apply fixed z-[9999] bg-slate-900 text-white text-xs font-medium px-3 py-2 rounded-lg shadow-xl opacity-0 transition-opacity duration-200 pointer-events-none max-w-xs text-center leading-relaxed; }
        .custom-tooltip.show { @apply opacity-100; }

        /* CUSTOM DROPDOWN STYLING (Unified for Single & Multi) */
        .custom-select { @apply relative w-full font-normal; }

        .custom-select-display {
            @apply w-full px-3 py-2 text-xs border border-slate-300 rounded-lg bg-white cursor-pointer min-h-[34px] flex items-center whitespace-nowrap overflow-hidden text-ellipsis text-slate-700 relative select-none transition-colors hover:border-blue-400;
        }

        /* Dropdown Arrow */
        .custom-select-display::after { content: ''; @apply absolute right-3 top-1/2 -translate-y-1/2 border-4 border-transparent border-t-slate-400; }
        .custom-select-display.empty::before { content: 'All'; @apply text-slate-400; }

        /* The Dropdown Menu - FIXED WIDTH */
        .custom-select-dropdown {
            @apply absolute top-full left-0 min-w-[160px] w-auto max-w-[240px] bg-white border border-slate-200 rounded-xl shadow-2xl z-50 hidden mt-1 max-h-64 overflow-y-auto p-1;
        }
        .custom-select-dropdown.open { @apply block; }

        /* Options */
        .custom-select-option {
            @apply flex items-center gap-2 px-3 py-2 hover:bg-slate-50 rounded-lg cursor-pointer transition-colors text-xs text-slate-700 select-none;
        }

        /* Checkbox/Radio Styling */
        .custom-select-option input[type="checkbox"],
        .custom-select-option input[type="radio"] {
            @apply rounded border-slate-300 text-blue-600 focus:ring-blue-500 w-3.5 h-3.5 shrink-0;
        }

        /* Footer (Clear button) */
        .custom-select-footer { @apply sticky bottom-0 bg-white border-t border-slate-100 p-2 mt-1 flex justify-end; }
        .custom-select-clear { @apply text-xs text-blue-600 hover:text-blue-800 font-medium hover:underline; }

        /* Arrows */
        .sort-arrows { @apply inline-block ml-1 text-slate-900 transition-colors; }
        .sort-arrows.active { @apply text-blue-600 font-bold scale-110; }

        /* Utils */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    }
</style>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 mb-6">

    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col max-h-[185vh]">
        <div class="overflow-auto">
            <table id="appsTable" class="w-full text-left border-collapse">

                <thead class="sticky top-0 z-20 bg-slate-50 shadow-sm text-slate-700">
                    <tr class="border-b border-slate-200 text-xs font-bold uppercase tracking-wider">
                        <th class="px-3 py-3 w-48 cursor-pointer hover:bg-slate-100 group select-none" data-tooltip="Application name"><div class="flex items-center gap-1">App Name<span class="sort-arrows">⇅</span></div></th>
                        <th class="px-3 py-3 w-32 cursor-pointer hover:bg-slate-100 group select-none" data-tooltip="Application category"><div class="flex items-center gap-1">Category <span class="sort-arrows">⇅</span></div></th>
                        <th class="px-3 py-3 w-24 cursor-pointer hover:bg-slate-100 group select-none" data-tooltip="Single Sign-On Support & Tier"><div class="flex items-center gap-1">SSO <span class="sort-arrows">⇅</span></div></th>
                        <th class="px-3 py-3 w-32 cursor-pointer hover:bg-slate-100 group select-none" data-tooltip="Supported Protocols (SAML, OIDC)"><div class="flex items-center gap-1">Protocols <span class="sort-arrows">⇅</span></div></th>
                        <th class="px-3 py-3 w-24 cursor-pointer hover:bg-slate-100 group select-none" data-tooltip="SCIM Provisioning Support"><div class="flex items-center gap-1">SCIM <span class="sort-arrows">⇅</span></div></th>
                        <th class="px-3 py-3 w-24 cursor-pointer hover:bg-slate-100 group select-none" data-tooltip="MFA Enforcement Policy"><div class="flex items-center gap-1">MFA <span class="sort-arrows">⇅</span></div></th>
                        <th class="px-3 py-3 w-40 cursor-pointer hover:bg-slate-100 group select-none" data-tooltip="Supported MFA Methods"><div class="flex items-center gap-1">MFA Types <span class="sort-arrows">⇅</span></div></th>
                        <th class="px-3 py-3 w-32 cursor-pointer hover:bg-slate-100 group select-none" data-tooltip="Security Certifications"><div class="flex items-center gap-1">Compliance <span class="sort-arrows">⇅</span></div></th>
                        <th class="px-3 py-3 w-36 cursor-pointer hover:bg-slate-100 group select-none" data-tooltip="Last verified date"><div class="flex items-center gap-1">Verified On<span class="sort-arrows">⇅</span></div></th>
                    </tr>

                    <tr class="bg-slate-50 border-b border-slate-200">
                        <th class="p-2 align-top">
                            <div class="flex items-center gap-1">
                                <input type="text" id="filterApp" placeholder="Filter..." class="w-full px-3 py-2 text-xs border border-slate-300 rounded-lg focus:border-blue-500 outline-none font-normal bg-white">
                                <button id="clearFiltersBtn" title="Clear all filters" class="p-2 text-slate-400 hover:text-red-500 transition-colors bg-white border border-slate-300 rounded-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                                    </svg>
                                </button>
                            </div>
                        </th>

                        <th class="p-2 align-top"><div id="filterCategory" class="custom-select"><div class="custom-select-display empty"></div><div class="custom-select-dropdown"></div></div></th>
                        <th class="p-2 align-top"><div id="filterSSO" class="custom-select"><div class="custom-select-display empty"></div><div class="custom-select-dropdown"></div></div></th>
                        <th class="p-2 align-top"><div id="filterSSOProtocols" class="custom-select"><div class="custom-select-display empty"></div><div class="custom-select-dropdown"></div></div></th>
                        <th class="p-2 align-top"><div id="filterSCIM" class="custom-select"><div class="custom-select-display empty"></div><div class="custom-select-dropdown"></div></div></th>
                        <th class="p-2 align-top"><div id="filterMFA" class="custom-select"><div class="custom-select-display empty"></div><div class="custom-select-dropdown"></div></div></th>
                        <th class="p-2 align-top"><div id="filterMFATypes" class="custom-select"><div class="custom-select-display empty"></div><div class="custom-select-dropdown"></div></div></th>
                        <th class="p-2 align-top"><div id="filterCompliance" class="custom-select"><div class="custom-select-display empty"></div><div class="custom-select-dropdown"></div></div></th>
                        <th class="p-2 align-top"><div id="filterVerified" class="custom-select"><div class="custom-select-display empty"></div><div class="custom-select-dropdown"></div></div></th>
                    </tr>
                </thead>

                <tbody class="divide-y divide-slate-100 bg-white">
                    {{ range $.Site.Data.apps }}
                    <tr class="hover:bg-blue-50/60 transition-colors group">
                        <td class="px-3 py-2.5"
                            data-app="{{ .name }}"
                            data-category="{{ .category }}"
                            data-sso="{{ if .sso.supported }}{{ .sso.tier }}{{ else }}none{{ end }}"
                            data-sso-protocols="{{ delimit .sso.protocols "," }}"
                            data-scim="{{ .scim.tier }}"
                            data-mfa="{{ if .mfa.supported }}{{ .mfa.enforcement }}{{ else }}none{{ end }}"
                            data-mfa-types="{{ delimit .mfa.types "," }}"
                            data-compliance="{{ if .compliance.soc2 }}soc2,{{ end }}{{ if .compliance.iso27001 }}iso27001{{ end }}"
                            data-verified="{{ .meta.last_verified }}">
                            <a href="{{ .website }}" target="_blank" class="text-sm font-semibold text-slate-900 hover:text-blue-600 flex items-center gap-2">{{ .name }} <svg class="w-3 h-3 text-slate-300 opacity-0 group-hover:opacity-100 transition-opacity" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg></a>
                        </td>
                        <td class="px-3 py-2.5"><span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-slate-100 text-slate-600 capitalize border border-slate-200">{{ .category }}</span></td>
                        <td class="px-3 py-2.5">
    {{ if .sso.supported }}
        <div class="flex items-center gap-2">
            <span class="text-green-600 text-base font-bold">✓</span>
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-white text-slate-700 border border-slate-200 capitalize">{{ .sso.tier }}</span>
        </div>
    {{ else }}
        <div class="flex items-center gap-2">
            <span class="text-slate-400 text-base">✗</span>
            <span class="text-xs text-slate-500">Not Supported</span>
        </div>
    {{ end }}
</td><td class="px-3 py-2.5">{{ if .sso.supported }}<div class="flex flex-wrap gap-1">{{ range .sso.protocols }}<span class="text-[11px] font-semibold px-1.5 py-0.5 bg-white text-slate-600 border border-slate-200 rounded shadow-sm">{{ . }}</span>{{ end }}</div>{{ else }}<span class="text-slate-300 text-xs">—</span>{{ end }}</td>
                        <!-- SCIM Column - PROPOSED -->
<td class="px-3 py-2.5">
    {{ if eq .scim.supported "full" }}
        <div class="flex items-center gap-2">
            <span class="text-green-600 text-base font-bold">✓</span>
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-white text-slate-700 border border-slate-200 capitalize">{{ .scim.tier }}</span>
        </div>
    {{ else if eq .scim.supported "partial" }}
        <div class="flex items-center gap-2">
            <span class="text-amber-500 text-base font-bold">~</span>
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-semibold bg-white text-slate-700 border border-slate-200 capitalize">{{ .scim.tier }}</span>
        </div>
    {{ else }}
        <div class="flex items-center gap-2">
            <span class="text-slate-400 text-base">✗</span>
            <span class="text-xs text-slate-500">Not Supported</span>
        </div>
    {{ end }}
</td>

<!-- MFA Column - PROPOSED -->
<td class="px-3 py-2.5">
    {{ if .mfa.supported }}
        <div class="flex items-center gap-2">
            <span class="text-green-600 text-base font-bold">✓</span>
            <span class="text-xs text-slate-700 font-medium capitalize">
                {{ if eq .mfa.enforcement "admin_enforced" }}Admin
                {{ else if eq .mfa.enforcement "optional" }}Optional
                {{ else if eq .mfa.enforcement "required" }}Required
                {{ else }}{{ .mfa.enforcement }}{{ end }}
            </span>
        </div>
    {{ else }}
        <div class="flex items-center gap-2">
            <span class="text-slate-400 text-base">✗</span>
            <span class="text-xs text-slate-500">Not Supported</span>
        </div>
    {{ end }}
</td>
 <td class="px-3 py-2.5">
    {{ if .mfa.supported }}
        <div class="flex flex-wrap gap-1">
            {{ range .mfa.types }}
                <span class="text-[11px] font-semibold px-1.5 py-0.5 bg-white text-slate-600 border border-slate-200 rounded shadow-sm">{{ . }}</span>
            {{ end }}
        </div>
    {{ else }}
        <span class="text-slate-300 text-xs">—</span>
    {{ end }}
</td>
                       <td class="px-3 py-2.5"><div class="flex flex-wrap gap-1">{{ if .compliance.soc2 }}<span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-50 text-purple-700 border border-purple-100">SOC2</span>{{ end }}{{ if .compliance.iso27001 }}<span class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-indigo-50 text-indigo-700 border border-indigo-100">ISO</span>{{ end }}</div></td>
                        <td class="px-3 py-2.5">{{ $date := time .meta.last_verified }}<span class="text-xs font-mono text-slate-500">{{ $date.Format "2006-01-02" }}</span></td>
                    </tr>
                    {{ end }}
                </tbody>
            </table>
        </div>
    </div>
    <div class="flex justify-end mt-4">
        <button id="exportCSVBtn" class="flex items-center gap-2 bg-white hover:bg-slate-50 text-slate-700 border border-slate-300 font-medium py-2 px-4 rounded-lg shadow-sm transition-all active:scale-95 text-sm">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
            Export to CSV
        </button>
    </div>
</div>